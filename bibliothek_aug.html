<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>ğŸ“š Bibliothek der AnfÃ¤nge â€“ Augenblick</title>
<script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
<style>
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at 30% 40%, #0b1223, #05070f 80%);
  color:#eaeaea;
  font-family:system-ui,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1{margin:1rem 0;color:#8cf;}

.regal{
  width:95%;
  max-width:900px;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:1.4rem;
  padding:2.5rem 2rem;
}

.buch{
  position:relative;
  height:160px;
  background:linear-gradient(90deg,#182545,#0e162e);
  border-radius:10px;
  border:1px solid rgba(130,170,255,.25);
  box-shadow:0 10px 25px rgba(0,0,0,.55);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  transition:box-shadow .2s, transform .15s;
  cursor:pointer;
}

.buch.attention{
  box-shadow:0 0 35px rgba(140,200,255,.7);
}

.icons{margin-top:8px;font-size:1.4rem;}

.progress-wrap{
  position:absolute;
  bottom:10px;
  width:70%;
  height:6px;
  background:rgba(255,255,255,.15);
  border-radius:4px;
  overflow:hidden;
}

.progress{
  width:0%;
  height:100%;
  background:linear-gradient(90deg,#7fd7ff,#cfefff);
}

#quality{
  position:fixed;
  top:10px;
  right:10px;
  width:140px;
  height:20px;
  border:1px solid #7fd7ff;
  border-radius:4px;
  background:rgba(255,255,255,0.1);
}
#quality-inner{
  width:0%;
  height:100%;
  background:#7fd7ff;
  border-radius:3px;
  transition:width 0.05s;
}
</style>
</head>

<body>

<h1>ğŸ“š Bibliothek der AnfÃ¤nge</h1>

<div id="quality"><div id="quality-inner"></div></div>

<div class="regal">
  <div class="buch" data-link="a_v.html"><span>Vom Planschbecken ins Meer</span><div class="icons">ğŸ˜¨ ğŸ˜”</div><div class="progress-wrap"><div class="progress"></div></div></div>
  <div class="buch" data-link="buch2_intuition.html"><span>Intuition oder Einbildung?</span><div class="icons">â“ ğŸ˜</div><div class="progress-wrap"><div class="progress"></div></div></div>
  <div class="buch" data-link="selbstreflexion.html"><span>Selbstreflexion</span><div class="icons">ğŸ˜Š ğŸ˜Œ</div><div class="progress-wrap"><div class="progress"></div></div></div>
  <div class="buch" data-link="sternenuebung1.html"><span>SternenÃ¼bung</span><div class="icons">ğŸ“– ğŸ“–</div><div class="progress-wrap"><div class="progress"></div></div></div>
  <div class="buch" data-link="aurion_bibl.html"><span>Aurion</span><div class="icons">ğŸŒŸ ğŸ˜</div><div class="progress-wrap"><div class="progress"></div></div></div>
  <div class="buch" data-link="vorhof_aurion.html"><span>Vorhof zu Aurion</span><div class="icons">ğŸ“– ğŸ“–</div><div class="progress-wrap"><div class="progress"></div></div></div>
</div>

<script>
const FIXATION_MS = 1500;
const SMOOTH = 0.12; // sanftere GlÃ¤ttung fÃ¼r ruhigeres Tracking
const books = document.querySelectorAll(".buch");
let gazeX = innerWidth/2, gazeY = innerHeight/2;
const bookTimers = new Map();
const qualityBar = document.getElementById("quality-inner");

// Timer fÃ¼r jedes Buch + Klick aktivieren
books.forEach(b=>{
  bookTimers.set(b,0);
  b.addEventListener("click",()=>{window.location.href=b.dataset.link;});
});

// WebGazer Listener
webgazer.setRegression("ridge")
.setGazeListener(data=>{
  if(!data || !data.x || !data.y) return;

  // GlÃ¤ttung der Blickdaten
  gazeX += (data.x - gazeX) * SMOOTH;
  gazeY += (data.y - gazeY) * SMOOTH;

  let focused = null;
  books.forEach(book=>{
    const r = book.getBoundingClientRect();
    const inside = gazeX>r.left && gazeX<r.right && gazeY>r.top && gazeY<r.bottom;
    book.classList.toggle("attention", inside);

    if(inside){
      let t = bookTimers.get(book) + 50; // 50ms pro Frame
      bookTimers.set(book,t);

      // Fortschrittsbalken pro Buch
      const bar = book.querySelector(".progress");
      bar.style.width = Math.min(100,(t/FIXATION_MS*100))+"%";

      if(t >= FIXATION_MS) window.location.href = book.dataset.link;
      focused = book;
    } else {
      let t = bookTimers.get(book) - 25; // langsames ZurÃ¼ckfallen
      bookTimers.set(book, Math.max(0,t));
      const bar = book.querySelector(".progress");
      bar.style.width = Math.max(0,(bookTimers.get(book)/FIXATION_MS*100))+"%";
    }
  });

  // QualitÃ¤tsanzeige: StabilitÃ¤t des Blicks
  if(focused){
    const t = bookTimers.get(focused);
    qualityBar.style.width = Math.min(100,(t/FIXATION_MS*100))+"%";
  } else {
    qualityBar.style.width = "0%";
  }

}).begin();

webgazer.showVideo(false);
webgazer.showPredictionPoints(false);
window.addEventListener("beforeunload",()=>webgazer.end());
</script>

</body>
</html>
